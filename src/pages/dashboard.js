import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useAuth } from "../contexts/auth-context";
import { useNavigate } from "react-router-dom";
import { useState, useEffect } from "react";
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from "../components/ui/card";
import { Button } from "../components/ui/button";
import { Brain, Building, DollarSign, TrendingUp, AlertTriangle, Plus, FileText, BarChart3, Activity, Calculator, Loader2, Receipt } from "lucide-react";
import { ProtectedRoute } from "../components/auth/protected-route";
import { FinancialOverview } from "../components/financial-overview";
import { AIInsightsDashboard } from "../components/ai-insights-dashboard";
import { JournalNavigationBridge } from "../components/journal-navigation-bridge";
import { PageLayout } from "../components/page-layout";
import { useDashboardData } from "../hooks/useDashboardData";
import { getCompanyId } from "../lib/config";
export default function Dashboard() {
    const { user } = useAuth();
    const navigate = useNavigate();
    const [companyId, setCompanyId] = useState(getCompanyId());
    const { data: dashboardData, loading, error } = useDashboardData(companyId);
    // Listen for company changes from header
    useEffect(() => {
        const handleStorageChange = () => {
            const newCompanyId = getCompanyId();
            if (newCompanyId && newCompanyId !== companyId) {
                console.log('ðŸ”„ Dashboard page - Company changed from', companyId, 'to', newCompanyId);
                setCompanyId(newCompanyId);
            }
        };
        // Listen for localStorage changes
        window.addEventListener('storage', handleStorageChange);
        // Also listen for custom events (in case localStorage doesn't trigger)
        const handleCompanyChange = (e) => {
            const newCompanyId = e.detail.companyId;
            if (newCompanyId && newCompanyId !== companyId) {
                console.log('ðŸ”„ Dashboard page - Company changed via custom event from', companyId, 'to', newCompanyId);
                setCompanyId(newCompanyId);
            }
        };
        window.addEventListener('companyChanged', handleCompanyChange);
        return () => {
            window.removeEventListener('storage', handleStorageChange);
            window.removeEventListener('companyChanged', handleCompanyChange);
        };
    }, [companyId]);
    return (_jsx(ProtectedRoute, { children: _jsx(PageLayout, { children: _jsxs("div", { className: "space-y-6", children: [_jsxs("div", { className: "flex items-center justify-between bg-gradient-to-r from-cyan-50 to-blue-50 rounded-xl p-6 border border-cyan-100", children: [_jsxs("div", { children: [_jsx("h1", { className: "text-4xl font-bold tracking-tight bg-gradient-to-r from-cyan-600 to-blue-600 bg-clip-text text-transparent", children: "Dashboard" }), _jsx("p", { className: "text-muted-foreground mt-1 text-lg", children: "Financial Overview & Analytics" }), _jsxs("div", { className: "flex items-center gap-4 mt-2", children: [_jsxs("div", { className: "flex items-center gap-2 text-sm text-green-600", children: [_jsx("div", { className: "w-2 h-2 bg-green-500 rounded-full animate-pulse" }), "System Healthy"] }), _jsxs("div", { className: "text-sm text-muted-foreground", children: ["Last updated: ", new Date().toLocaleTimeString()] })] })] }), _jsxs("div", { className: "flex space-x-3", children: [_jsxs(Button, { variant: "outline", className: "hover:bg-cyan-50 hover:border-cyan-200", onClick: () => navigate('/dashboard/reports'), children: [_jsx(Activity, { className: "mr-2 h-4 w-4" }), "Export Report"] }), _jsxs(Button, { className: "bg-gradient-to-r from-cyan-600 to-blue-600 hover:from-cyan-700 hover:to-blue-700 shadow-lg", onClick: () => navigate('/dashboard/reports?tab=analytics'), children: [_jsx(BarChart3, { className: "mr-2 h-4 w-4" }), "View Analytics"] })] })] }), _jsx("div", { className: "bg-white rounded-xl shadow-lg border border-gray-100 hover:shadow-xl transition-all duration-300", children: _jsx(FinancialOverview, { companyId: companyId }) }), _jsx("div", { className: "bg-white rounded-xl shadow-lg border border-gray-100 hover:shadow-xl transition-all duration-300", children: _jsx(JournalNavigationBridge, { companyId: companyId, onNavigate: (path) => navigate(path), showQuickStats: true, showRecentActivity: true, compact: false }) }), _jsxs("div", { className: "grid gap-6 md:grid-cols-2 lg:grid-cols-3", children: [_jsx("div", { className: "lg:col-span-2", children: _jsxs(Card, { className: "h-full", children: [_jsxs(CardHeader, { children: [_jsxs(CardTitle, { className: "flex items-center gap-2", children: [_jsx(Plus, { className: "h-5 w-5 text-blue-600" }), "Quick Actions"] }), _jsx(CardDescription, { children: "Common tasks and shortcuts to get you started" })] }), _jsx(CardContent, { children: _jsxs("div", { className: "grid gap-3 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4", children: [_jsxs(Button, { variant: "outline", className: "h-32 flex-col gap-3 hover:bg-gradient-to-br hover:from-blue-50 hover:to-cyan-50 hover:border-blue-300 hover:shadow-md transition-all duration-300 p-4 group", onClick: () => navigate('/dashboard/settings'), children: [_jsx("div", { className: "p-2 bg-blue-100 rounded-lg group-hover:bg-blue-200 transition-colors", children: _jsx(Building, { className: "h-6 w-6 text-blue-600" }) }), _jsxs("div", { className: "text-center", children: [_jsx("span", { className: "font-semibold text-sm text-gray-900 block", children: "New Company" }), _jsx("span", { className: "text-xs text-gray-600 leading-tight", children: "Set up new business" })] })] }), _jsxs(Button, { variant: "outline", className: "h-32 flex-col gap-3 hover:bg-gradient-to-br hover:from-green-50 hover:to-emerald-50 hover:border-green-300 hover:shadow-md transition-all duration-300 p-4 group", onClick: () => navigate('/dashboard/sales'), children: [_jsx("div", { className: "p-2 bg-green-100 rounded-lg group-hover:bg-green-200 transition-colors", children: _jsx(DollarSign, { className: "h-6 w-6 text-green-600" }) }), _jsxs("div", { className: "text-center", children: [_jsx("span", { className: "font-semibold text-sm text-gray-900 block", children: "Create Invoice" }), _jsx("span", { className: "text-xs text-gray-600 leading-tight", children: "Generate invoice" })] })] }), _jsxs(Button, { variant: "outline", className: "h-32 flex-col gap-3 hover:bg-gradient-to-br hover:from-purple-50 hover:to-indigo-50 hover:border-purple-300 hover:shadow-md transition-all duration-300 p-4 group", onClick: () => navigate('/dashboard/reports'), children: [_jsx("div", { className: "p-2 bg-purple-100 rounded-lg group-hover:bg-purple-200 transition-colors", children: _jsx(TrendingUp, { className: "h-6 w-6 text-purple-600" }) }), _jsxs("div", { className: "text-center", children: [_jsx("span", { className: "font-semibold text-sm text-gray-900 block", children: "View Reports" }), _jsx("span", { className: "text-xs text-gray-600 leading-tight", children: "Financial reports" })] })] }), _jsxs(Button, { variant: "outline", className: "h-32 flex-col gap-3 hover:bg-gradient-to-br hover:from-orange-50 hover:to-amber-50 hover:border-orange-300 hover:shadow-md transition-all duration-300 p-4 group", onClick: () => navigate('/dashboard/ai-insights'), children: [_jsx("div", { className: "p-2 bg-orange-100 rounded-lg group-hover:bg-orange-200 transition-colors", children: _jsx(Brain, { className: "h-6 w-6 text-orange-600" }) }), _jsxs("div", { className: "text-center", children: [_jsx("span", { className: "font-semibold text-sm text-gray-900 block", children: "AI Insights" }), _jsx("span", { className: "text-xs text-gray-600 leading-tight", children: "AI recommendations" })] })] }), _jsxs(Button, { variant: "outline", className: "h-32 flex-col gap-3 hover:bg-gradient-to-br hover:from-indigo-50 hover:to-purple-50 hover:border-indigo-300 hover:shadow-md transition-all duration-300 p-4 group", onClick: () => navigate('/dashboard/accounting'), children: [_jsx("div", { className: "p-2 bg-indigo-100 rounded-lg group-hover:bg-indigo-200 transition-colors", children: _jsx(Calculator, { className: "h-6 w-6 text-indigo-600" }) }), _jsxs("div", { className: "text-center", children: [_jsx("span", { className: "font-semibold text-sm text-gray-900 block", children: "Chart of Accounts" }), _jsx("span", { className: "text-xs text-gray-600 leading-tight", children: "Manage accounts" })] })] }), _jsxs(Button, { variant: "outline", className: "h-32 flex-col gap-3 hover:bg-gradient-to-br hover:from-teal-50 hover:to-cyan-50 hover:border-teal-300 hover:shadow-md transition-all duration-300 p-4 group", onClick: () => navigate('/dashboard/journal/new'), children: [_jsx("div", { className: "p-2 bg-teal-100 rounded-lg group-hover:bg-teal-200 transition-colors", children: _jsx(FileText, { className: "h-6 w-6 text-teal-600" }) }), _jsxs("div", { className: "text-center", children: [_jsx("span", { className: "font-semibold text-sm text-gray-900 block", children: "New Journal Entry" }), _jsx("span", { className: "text-xs text-gray-600 leading-tight", children: "Record transactions" })] })] }), _jsxs(Button, { variant: "outline", className: "h-32 flex-col gap-3 hover:bg-gradient-to-br hover:from-amber-50 hover:to-yellow-50 hover:border-amber-300 hover:shadow-md transition-all duration-300 p-4 group", onClick: () => navigate('/dashboard/accounting?tab=trial-balance'), children: [_jsx("div", { className: "p-2 bg-amber-100 rounded-lg group-hover:bg-amber-200 transition-colors", children: _jsx(Calculator, { className: "h-6 w-6 text-amber-600" }) }), _jsxs("div", { className: "text-center", children: [_jsx("span", { className: "font-semibold text-sm text-gray-900 block", children: "Trial Balance" }), _jsx("span", { className: "text-xs text-gray-600 leading-tight", children: "View balances" })] })] })] }) })] }) }), _jsxs("div", { className: "space-y-6", children: [_jsxs(Card, { children: [_jsx(CardHeader, { className: "pb-3", children: _jsxs(CardTitle, { className: "text-lg flex items-center gap-2", children: [_jsx(TrendingUp, { className: "h-5 w-5 text-green-600" }), "This Month"] }) }), _jsxs(CardContent, { className: "space-y-4", children: [_jsxs("div", { className: "flex items-center justify-between", children: [_jsx("span", { className: "text-sm text-gray-600", children: "Revenue" }), _jsxs("span", { className: `font-semibold ${(dashboardData?.metrics?.totalRevenue || 0) > 0 ? 'text-green-600' : 'text-gray-600'}`, children: ["$", (dashboardData?.metrics?.totalRevenue || 0).toLocaleString()] })] }), _jsxs("div", { className: "flex items-center justify-between", children: [_jsx("span", { className: "text-sm text-gray-600", children: "Expenses" }), _jsxs("span", { className: `font-semibold ${(dashboardData?.metrics?.totalExpenses || 0) > 0 ? 'text-orange-600' : 'text-gray-600'}`, children: ["$", (dashboardData?.metrics?.totalExpenses || 0).toLocaleString()] })] }), _jsxs("div", { className: "flex items-center justify-between", children: [_jsx("span", { className: "text-sm text-gray-600", children: "Profit" }), _jsxs("span", { className: `font-semibold ${(dashboardData?.metrics?.netProfit || 0) > 0 ? 'text-blue-600' : (dashboardData?.metrics?.netProfit || 0) < 0 ? 'text-red-600' : 'text-gray-600'}`, children: ["$", (dashboardData?.metrics?.netProfit || 0).toLocaleString()] })] }), _jsx("div", { className: "pt-3 border-t", children: _jsxs("div", { className: "flex items-center justify-between", children: [_jsx("span", { className: "text-sm font-medium", children: "Net Growth" }), _jsxs("span", { className: `text-lg font-bold ${(dashboardData?.metrics?.netProfit || 0) > 0 ? 'text-green-600' : 'text-red-600'}`, children: [(dashboardData?.metrics?.netProfit || 0) > 0 ? '+' : '', "$", (dashboardData?.metrics?.netProfit || 0).toLocaleString()] })] }) })] })] }), _jsxs(Card, { children: [_jsx(CardHeader, { className: "pb-3", children: _jsxs(CardTitle, { className: "text-lg flex items-center gap-2", children: [_jsx(AlertTriangle, { className: "h-5 w-5 text-amber-600" }), "Alerts"] }) }), _jsxs(CardContent, { className: "space-y-3", children: [(dashboardData?.metrics?.overdueInvoices || 0) > 0 && (_jsxs("div", { className: "flex items-center gap-3 p-2 bg-amber-50 rounded-lg", children: [_jsx("div", { className: "w-2 h-2 bg-amber-500 rounded-full" }), _jsxs("span", { className: "text-sm text-amber-700", children: ["$", (dashboardData?.metrics?.overdueInvoices || 0).toLocaleString(), " in overdue invoices"] })] })), (dashboardData?.metrics?.pendingInvoices || 0) > 0 && (_jsxs("div", { className: "flex items-center gap-3 p-2 bg-blue-50 rounded-lg", children: [_jsx("div", { className: "w-2 h-2 bg-blue-500 rounded-full" }), _jsxs("span", { className: "text-sm text-blue-700", children: ["$", (dashboardData?.metrics?.pendingInvoices || 0).toLocaleString(), " in pending invoices"] })] })), _jsxs("div", { className: "flex items-center gap-3 p-2 bg-green-50 rounded-lg", children: [_jsx("div", { className: "w-2 h-2 bg-green-500 rounded-full" }), _jsxs("span", { className: "text-sm text-green-700", children: [dashboardData?.metrics?.activeCustomers || 0, " active customers"] })] })] })] })] })] }), _jsx(AIInsightsDashboard, { maxItems: 3, compact: true, showViewAll: true }), _jsxs(Card, { className: "bg-white rounded-xl shadow-sm border border-gray-200", children: [_jsxs(CardHeader, { children: [_jsxs(CardTitle, { className: "flex items-center gap-2", children: [_jsx(Activity, { className: "h-5 w-5 text-gray-600" }), "Recent Activity"] }), _jsx(CardDescription, { children: "Latest updates and changes across your account" })] }), _jsx(CardContent, { children: _jsx("div", { className: "space-y-4", children: loading ? (_jsxs("div", { className: "flex items-center justify-center py-8", children: [_jsx(Loader2, { className: "h-6 w-6 animate-spin mr-2" }), _jsx("span", { className: "text-sm text-gray-500", children: "Loading recent activity..." })] })) : error ? (_jsxs("div", { className: "flex items-center justify-center py-8 text-red-600", children: [_jsx(AlertTriangle, { className: "h-6 w-6 mr-2" }), _jsx("span", { className: "text-sm", children: "Error loading activity" })] })) : (dashboardData?.recentActivity?.length || 0) > 0 ? (dashboardData?.recentActivity?.slice(0, 4).map((activity) => (_jsxs("div", { className: "flex items-center gap-4 p-4 rounded-lg border border-gray-100 hover:bg-gray-50 transition-colors", children: [_jsxs("div", { className: "flex items-center gap-3", children: [_jsx("div", { className: `p-2 rounded-full ${activity.type === 'journal_entry' ? 'bg-purple-100' : 'bg-blue-100'}`, children: activity.type === 'journal_entry' ? (_jsx(Receipt, { className: "w-4 h-4 text-purple-600" })) : (_jsx(FileText, { className: "w-4 h-4 text-blue-600" })) }), _jsx("div", { className: `w-3 h-3 rounded-full ${activity.status === 'posted' ? 'bg-green-500' :
                                                            activity.status === 'draft' ? 'bg-yellow-500' :
                                                                'bg-blue-500'}` })] }), _jsxs("div", { className: "flex-1", children: [_jsx("p", { className: "text-sm font-medium text-gray-900", children: activity.title }), _jsx("p", { className: "text-xs text-gray-600", children: activity.description }), _jsxs("p", { className: "text-xs text-gray-500 capitalize", children: [activity.type.replace('_', ' '), " \u2022 ", activity.status] })] }), _jsx("span", { className: "text-xs text-gray-500", children: new Date(activity.date).toLocaleDateString() })] }, activity.id)))) : (_jsxs("div", { className: "flex items-center justify-center py-8 text-gray-500", children: [_jsx(Activity, { className: "h-6 w-6 mr-2" }), _jsx("span", { className: "text-sm", children: "No recent activity" })] })) }) })] })] }) }) }));
}
