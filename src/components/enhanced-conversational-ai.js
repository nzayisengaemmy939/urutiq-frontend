import { jsx as _jsx, jsxs as _jsxs } from "react/jsx-runtime";
import { useState, useRef, useEffect } from "react";
import { Card, CardContent, CardHeader, CardTitle } from "../components/ui/card";
import { Button } from "../components/ui/button";
import { Textarea } from "../components/ui/textarea";
import { Badge } from "../components/ui/badge";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "../components/ui/tabs";
import { ScrollArea } from "../components/ui/scroll-area";
import { useToast } from "../components/ui/use-toast";
import { useDemoAuth } from "../hooks/useDemoAuth";
import apiService from "../lib/api";
import { AITransactionCategorization } from "../components/ai-transaction-categorization";
import { AINaturalLanguageReports } from "../components/ai-natural-language-reports";
import { ConversationalParser } from "../components/conversational-parser";
import { Send, MessageCircle, Brain, TrendingUp, CheckCircle, Zap, Lightbulb, BarChart3, FileText, Bot, Sparkles, Target, Activity, Shield, ArrowRight, MessageSquare } from "lucide-react";
export function EnhancedConversationalAI({ companyId = "demo-company" }) {
    const [activeTab, setActiveTab] = useState("chat");
    const [inputText, setInputText] = useState("");
    const [messages, setMessages] = useState([]);
    const [isLoading, setIsLoading] = useState(false);
    const { ready: authReady } = useDemoAuth('enhanced-conversational-ai');
    const [aiMode, setAiMode] = useState("enhanced");
    const [showAIPanel, setShowAIPanel] = useState(false);
    const [examples, setExamples] = useState(null);
    const textareaRef = useRef(null);
    const { toast } = useToast();
    // Load examples on component mount
    useEffect(() => {
        if (!authReady)
            return;
        const loadExamples = async () => {
            try {
                const response = await apiService.get('/enhanced-conversational-ai/examples');
                setExamples(response.data);
            }
            catch (error) {
                console.error('Failed to load examples:', error);
            }
        };
        loadExamples();
    }, [authReady]);
    const handleSendMessage = async () => {
        if (!inputText.trim())
            return;
        const userMessage = {
            id: Date.now().toString(),
            content: inputText,
            role: "user",
            timestamp: new Date(),
            type: "text"
        };
        setMessages(prev => [...prev, userMessage]);
        setInputText("");
        setIsLoading(true);
        try {
            const response = await apiService.post('/enhanced-conversational-ai/chat', {
                text: inputText,
                companyId,
                mode: aiMode
            });
            const assistantMessage = {
                id: (Date.now() + 1).toString(),
                content: response.data?.data?.response || response.data?.data?.message || "I received your message but couldn't process it properly.",
                role: "assistant",
                timestamp: new Date(),
                type: "text"
            };
            setMessages(prev => [...prev, assistantMessage]);
        }
        catch (error) {
            const errorMessage = {
                id: (Date.now() + 1).toString(),
                content: "Sorry, I encountered an error. Please try again.",
                role: "assistant",
                timestamp: new Date(),
                type: "error"
            };
            setMessages(prev => [...prev, errorMessage]);
        }
        finally {
            setIsLoading(false);
        }
    };
    const handleKeyPress = (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            handleSendMessage();
        }
    };
    const renderExamples = () => {
        if (!examples)
            return (_jsx("div", { className: "flex items-center justify-center h-64", children: _jsxs("div", { className: "text-center", children: [_jsx("div", { className: "p-4 bg-gradient-to-r from-[#009688]/10 to-[#1565c0]/10 rounded-full w-fit mx-auto mb-4", children: _jsx(Lightbulb, { className: "w-8 h-8 text-[#009688] animate-pulse" }) }), _jsx("p", { className: "text-muted-foreground", children: "Loading example phrases..." })] }) }));
        return (_jsxs("div", { className: "space-y-6", children: [examples.categories?.map((category, index) => (_jsxs(Card, { className: "border-0 shadow-lg bg-gradient-to-br from-white to-gray-50/50", children: [_jsx(CardHeader, { className: "bg-gradient-to-r from-[#009688]/10 to-[#1565c0]/10 border-b", children: _jsxs(CardTitle, { className: "flex items-center gap-3", children: [_jsx("div", { className: "p-2 bg-gradient-to-r from-[#009688] to-[#1565c0] rounded-lg", children: _jsx(FileText, { className: "w-5 h-5 text-white" }) }), _jsxs("div", { children: [_jsx("span", { className: "text-lg font-bold", children: category.name }), _jsx("p", { className: "text-sm text-muted-foreground font-normal", children: "Click any example to try it" })] })] }) }), _jsx(CardContent, { className: "p-6", children: _jsx("div", { className: "space-y-3", children: category.examples?.map((example, exampleIndex) => (_jsx("div", { className: "p-4 bg-gradient-to-r from-gray-50/50 to-gray-100/30 rounded-xl cursor-pointer hover:bg-gradient-to-r hover:from-[#009688]/5 hover:to-[#1565c0]/5 transition-all duration-200 border border-gray-200/50 hover:border-[#009688]/30 group", onClick: () => {
                                        setInputText(example);
                                        setActiveTab('chat');
                                    }, children: _jsxs("div", { className: "flex items-center gap-3", children: [_jsx("div", { className: "p-2 bg-gradient-to-r from-[#009688] to-[#1565c0] rounded-lg group-hover:scale-110 transition-transform duration-200", children: _jsx(ArrowRight, { className: "w-4 h-4 text-white" }) }), _jsxs("div", { className: "flex-1", children: [_jsx("p", { className: "text-sm font-medium text-gray-800 group-hover:text-[#009688] transition-colors duration-200", children: example }), _jsx("p", { className: "text-xs text-muted-foreground mt-1", children: "Click to use this example" })] })] }) }, exampleIndex))) }) })] }, index))), _jsx(Card, { className: "border-0 shadow-lg bg-gradient-to-br from-[#009688]/5 to-[#1565c0]/5", children: _jsx(CardContent, { className: "p-6", children: _jsxs("div", { className: "text-center", children: [_jsx("div", { className: "p-3 bg-gradient-to-r from-[#009688] to-[#1565c0] rounded-full w-fit mx-auto mb-4", children: _jsx(Sparkles, { className: "w-6 h-6 text-white" }) }), _jsx("h3", { className: "text-lg font-semibold text-gray-800 mb-2", children: "Need More Help?" }), _jsx("p", { className: "text-sm text-muted-foreground mb-4", children: "The AI assistant understands natural language. Try describing your transactions in your own words!" }), _jsxs(Button, { variant: "outline", onClick: () => setActiveTab('chat'), className: "border-[#009688]/30 text-[#009688] hover:bg-[#009688]/10", children: ["Start Chatting", _jsx(ArrowRight, { className: "w-4 h-4 ml-2" })] })] }) }) })] }));
    };
    return (_jsxs("div", { className: "min-h-screen bg-gradient-to-br from-slate-50 to-blue-50/30", children: [_jsxs("div", { className: "relative overflow-hidden bg-gradient-to-r from-[#009688] to-[#1565c0] text-white", children: [_jsx("div", { className: "absolute inset-0 bg-black/10" }), _jsx("div", { className: "relative px-6 py-12", children: _jsx("div", { className: "max-w-7xl mx-auto", children: _jsxs("div", { className: "flex items-center justify-between", children: [_jsxs("div", { className: "space-y-4", children: [_jsxs("div", { className: "flex items-center gap-3", children: [_jsx("div", { className: "p-3 bg-white/20 rounded-xl backdrop-blur-sm", children: _jsx(Bot, { className: "w-8 h-8" }) }), _jsxs("div", { children: [_jsx("h1", { className: "text-4xl font-bold tracking-tight", children: " Conversational AI" }), _jsx("p", { className: "text-blue-100 text-lg", children: "Powered by Llama 3.1 - Your intelligent financial assistant" })] })] }), _jsxs("div", { className: "flex items-center gap-4", children: [_jsxs(Badge, { variant: "secondary", className: "bg-white/20 text-white border-white/30", children: [_jsx(Sparkles, { className: "w-4 h-4 mr-2" }), "AI-Powered"] }), _jsxs(Badge, { variant: "secondary", className: "bg-white/20 text-white border-white/30", children: [_jsx(Brain, { className: "w-4 h-4 mr-2" }), "Natural Language"] }), _jsxs(Badge, { variant: "secondary", className: "bg-white/20 text-white border-white/30", children: [_jsx(Shield, { className: "w-4 h-4 mr-2" }), "Secure"] })] })] }), _jsx("div", { className: "hidden lg:block", children: _jsx("div", { className: "p-6 bg-white/10 rounded-2xl backdrop-blur-sm border border-white/20", children: _jsxs("div", { className: "text-center", children: [_jsx("div", { className: "p-3 bg-white/20 rounded-full w-fit mx-auto mb-3", children: _jsx(Activity, { className: "w-8 h-8" }) }), _jsx("h3", { className: "text-lg font-semibold mb-2", children: "AI Assistant Status" }), _jsxs("div", { className: "flex items-center gap-2 mb-2", children: [_jsx("div", { className: "w-2 h-2 bg-green-400 rounded-full animate-pulse" }), _jsx("span", { className: "text-sm", children: "Online & Ready" })] }), _jsx("p", { className: "text-xs text-blue-100", children: "Processing requests in real-time" })] }) }) })] }) }) })] }), _jsx("div", { className: "max-w-7xl mx-auto px-6 py-8", children: _jsxs(Tabs, { value: activeTab, onValueChange: setActiveTab, className: "space-y-6", children: [_jsx("div", { className: "px-6 pt-6 pb-2", children: _jsxs("div", { className: "mb-4", children: [_jsxs("div", { className: "flex items-center justify-between mb-3", children: [_jsx("h3", { className: "text-lg font-semibold text-gray-800", children: "AI Assistant Features" }), _jsxs("div", { className: "flex items-center gap-1 px-3 py-1 bg-gradient-to-r from-[#009688] to-[#1565c0] text-white rounded-full text-sm font-medium", children: [_jsx(Sparkles, { className: "w-3 h-3" }), "Llama 3.1"] })] }), _jsxs(TabsList, { className: "flex w-full bg-gradient-to-r from-[#009688]/10 to-[#1565c0]/10 p-1 rounded-xl border border-[#009688]/20 shadow-sm", children: [_jsxs(TabsTrigger, { value: "chat", className: `flex items-center gap-2 py-3 px-4 gap-2 ${activeTab === 'chat' ? 'bg-white text-[#009688] shadow-md' : 'text-gray-600 hover:text-[#009688]'}`, children: [_jsx("div", { className: "p-1.5 bg-gradient-to-r from-[#009688] to-[#1565c0] rounded-lg", children: _jsx(MessageCircle, { className: "w-4 h-4 text-white" }) }), "Chat"] }), _jsxs(TabsTrigger, { value: "insights", className: `flex items-center gap-1 py-2 px-3 gap-1 whitespace-nowrap ${activeTab === 'insights' ? 'bg-white text-[#009688] shadow-md' : 'text-gray-600 hover:text-[#009688]'}`, children: [_jsx(Brain, { className: "w-4 h-4" }), "AI Insights"] }), _jsxs(TabsTrigger, { value: "stats", className: `flex items-center gap-1 py-2 px-3 gap-1 whitespace-nowrap ${activeTab === 'stats' ? 'bg-white text-[#009688] shadow-md' : 'text-gray-600 hover:text-[#009688]'}`, children: [_jsx(BarChart3, { className: "w-4 h-4" }), "Stats"] }), _jsxs(TabsTrigger, { value: "categorization", className: `flex items-center gap-1 py-2 px-3 gap-1 whitespace-nowrap ${activeTab === 'categorization' ? 'bg-white text-[#009688] shadow-md' : 'text-gray-600 hover:text-[#009688]'}`, children: [_jsx(Target, { className: "w-4 h-4" }), "Auto Categorize"] }), _jsxs(TabsTrigger, { value: "reports", className: `flex items-center gap-1 py-2 px-3 gap-1 whitespace-nowrap ${activeTab === 'reports' ? 'bg-white text-[#009688] shadow-md' : 'text-gray-600 hover:text-[#009688]'}`, children: [_jsx(FileText, { className: "w-4 h-4" }), "Smart Reports"] }), _jsxs(TabsTrigger, { value: "parser", className: `flex items-center gap-1 py-2 px-3 gap-1 whitespace-nowrap ${activeTab === 'parser' ? 'bg-white text-[#009688] shadow-md' : 'text-gray-600 hover:text-[#009688]'}`, children: [_jsx(MessageSquare, { className: "w-4 h-4" }), "Transaction Parser"] })] })] }) }), _jsx(TabsContent, { value: "chat", className: "space-y-6", children: _jsxs("div", { className: "grid grid-cols-1 lg:grid-cols-3 gap-6", children: [_jsx("div", { className: "lg:col-span-2", children: _jsxs(Card, { className: "border-0 shadow-xl bg-white/80 backdrop-blur-sm", children: [_jsx(CardHeader, { className: "bg-gradient-to-r from-[#009688]/10 to-[#1565c0]/10 border-b", children: _jsxs(CardTitle, { className: "flex items-center gap-3", children: [_jsx("div", { className: "p-2 bg-gradient-to-r from-[#009688] to-[#1565c0] rounded-lg", children: _jsx(MessageCircle, { className: "w-5 h-5 text-white" }) }), _jsxs("div", { children: [_jsx("span", { className: "text-lg font-bold", children: "AI Chat Assistant" }), _jsx("p", { className: "text-sm text-muted-foreground font-normal", children: "Ask me anything about your finances" })] })] }) }), _jsxs(CardContent, { className: "p-0", children: [_jsx(ScrollArea, { className: "h-96 p-6", children: messages.length === 0 ? (_jsxs("div", { className: "text-center py-12", children: [_jsx("div", { className: "p-4 bg-gradient-to-r from-[#009688]/10 to-[#1565c0]/10 rounded-full w-fit mx-auto mb-4", children: _jsx(Bot, { className: "w-8 h-8 text-[#009688]" }) }), _jsx("h3", { className: "text-lg font-semibold text-gray-800 mb-2", children: "Welcome to Enhanced AI Assistant" }), _jsx("p", { className: "text-sm text-muted-foreground mb-4", children: "I'm powered by Llama 3.1 and can help you with:" }), _jsxs("div", { className: "grid grid-cols-2 gap-2 text-sm text-muted-foreground", children: [_jsxs("div", { className: "flex items-center gap-2", children: [_jsx(CheckCircle, { className: "w-4 h-4 text-green-500" }), "Auto Categorization"] }), _jsxs("div", { className: "flex items-center gap-2", children: [_jsx(CheckCircle, { className: "w-4 h-4 text-green-500" }), "Smart Reports"] }), _jsxs("div", { className: "flex items-center gap-2", children: [_jsx(CheckCircle, { className: "w-4 h-4 text-green-500" }), "Cash Flow Forecast"] }), _jsxs("div", { className: "flex items-center gap-2", children: [_jsx(CheckCircle, { className: "w-4 h-4 text-green-500" }), "Fraud Detection"] }), _jsxs("div", { className: "flex items-center gap-2", children: [_jsx(CheckCircle, { className: "w-4 h-4 text-green-500" }), "Transaction Parser"] }), _jsxs("div", { className: "flex items-center gap-2", children: [_jsx(CheckCircle, { className: "w-4 h-4 text-green-500" }), "AI Insights"] })] })] })) : (_jsxs("div", { className: "space-y-4", children: [messages.map((message) => (_jsx("div", { className: `flex ${message.role === 'user' ? 'justify-end' : 'justify-start'}`, children: _jsxs("div", { className: `max-w-[80%] p-4 rounded-2xl ${message.role === 'user'
                                                                                ? 'bg-gradient-to-r from-[#009688] to-[#1565c0] text-white'
                                                                                : message.type === 'error'
                                                                                    ? 'bg-red-50 text-red-800 border border-red-200'
                                                                                    : 'bg-gray-100 text-gray-800'}`, children: [_jsx("p", { className: "text-sm", children: message.content }), _jsx("p", { className: "text-xs opacity-70 mt-2", children: message.timestamp.toLocaleTimeString() })] }) }, message.id))), isLoading && (_jsx("div", { className: "flex justify-start", children: _jsx("div", { className: "bg-gray-100 text-gray-800 p-4 rounded-2xl", children: _jsxs("div", { className: "flex items-center gap-2", children: [_jsx("div", { className: "w-2 h-2 bg-gray-400 rounded-full animate-bounce" }), _jsx("div", { className: "w-2 h-2 bg-gray-400 rounded-full animate-bounce", style: { animationDelay: '0.1s' } }), _jsx("div", { className: "w-2 h-2 bg-gray-400 rounded-full animate-bounce", style: { animationDelay: '0.2s' } })] }) }) }))] })) }), _jsx("div", { className: "p-6 border-t bg-gray-50/50", children: _jsxs("div", { className: "flex gap-3", children: [_jsx(Textarea, { ref: textareaRef, value: inputText, onChange: (e) => setInputText(e.target.value), onKeyPress: handleKeyPress, placeholder: "Ask me anything about your finances...", className: "flex-1 min-h-[60px] resize-none border-gray-200 focus:border-[#009688] focus:ring-[#009688]" }), _jsx(Button, { onClick: handleSendMessage, disabled: !inputText.trim() || isLoading, className: "px-6 bg-gradient-to-r from-[#009688] to-[#1565c0] hover:from-[#009688]/90 hover:to-[#1565c0]/90 text-white border-0", children: _jsx(Send, { className: "w-4 h-4" }) })] }) })] })] }) }), _jsxs("div", { className: "space-y-6", children: [_jsxs(Card, { className: "border-0 shadow-lg bg-white/80 backdrop-blur-sm", children: [_jsx(CardHeader, { className: "bg-gradient-to-r from-[#009688]/10 to-[#1565c0]/10 border-b", children: _jsxs(CardTitle, { className: "flex items-center gap-3", children: [_jsx("div", { className: "p-2 bg-gradient-to-r from-[#009688] to-[#1565c0] rounded-lg", children: _jsx(Zap, { className: "w-5 h-5 text-white" }) }), _jsx("span", { className: "text-lg font-bold", children: "Quick Actions" })] }) }), _jsx(CardContent, { className: "p-6", children: _jsxs("div", { className: "space-y-3", children: [_jsxs(Button, { variant: "outline", onClick: () => setActiveTab('categorization'), className: "w-full justify-start border-[#009688]/30 text-[#009688] hover:bg-[#009688]/10", children: [_jsx(Target, { className: "w-4 h-4 mr-3" }), _jsxs("div", { className: "text-left", children: [_jsx("div", { className: "font-medium", children: "AI Categorization" }), _jsx("div", { className: "text-xs text-muted-foreground", children: "Auto-categorize transactions" })] })] }), _jsxs(Button, { variant: "outline", onClick: () => setActiveTab('reports'), className: "w-full justify-start border-[#009688]/30 text-[#009688] hover:bg-[#009688]/10", children: [_jsx(FileText, { className: "w-4 h-4 mr-3" }), _jsxs("div", { className: "text-left", children: [_jsx("div", { className: "font-medium", children: "Smart Reports" }), _jsx("div", { className: "text-xs text-muted-foreground", children: "Generate insights" })] })] }), _jsxs(Button, { variant: "outline", onClick: () => setActiveTab('forecasting'), className: "w-full justify-start border-[#009688]/30 text-[#009688] hover:bg-[#009688]/10", children: [_jsx(TrendingUp, { className: "w-4 h-4 mr-3" }), _jsxs("div", { className: "text-left", children: [_jsx("div", { className: "font-medium", children: "Cash Flow Forecast" }), _jsx("div", { className: "text-xs text-muted-foreground", children: "Predict future trends" })] })] }), _jsxs(Button, { variant: "outline", onClick: () => setActiveTab('parser'), className: "w-full justify-start border-[#009688]/30 text-[#009688] hover:bg-[#009688]/10", children: [_jsx(MessageSquare, { className: "w-4 h-4 mr-3" }), _jsxs("div", { className: "text-left", children: [_jsx("div", { className: "font-medium", children: "Transaction Parser" }), _jsx("div", { className: "text-xs text-muted-foreground", children: "Natural language to journal entries" })] })] })] }) })] }), _jsxs(Card, { className: "border-0 shadow-lg bg-white/80 backdrop-blur-sm", children: [_jsx(CardHeader, { className: "bg-gradient-to-r from-[#009688]/10 to-[#1565c0]/10 border-b", children: _jsxs(CardTitle, { className: "flex items-center gap-3", children: [_jsx("div", { className: "p-2 bg-gradient-to-r from-[#009688] to-[#1565c0] rounded-lg", children: _jsx(Lightbulb, { className: "w-5 h-5 text-white" }) }), _jsx("span", { className: "text-lg font-bold", children: "Example Phrases" })] }) }), _jsx(CardContent, { className: "p-6", children: _jsx(ScrollArea, { className: "h-64", children: renderExamples() }) })] })] })] }) }), _jsx(TabsContent, { value: "insights", className: "space-y-6", children: _jsxs(Card, { className: "border-0 shadow-xl bg-white/80 backdrop-blur-sm", children: [_jsx(CardHeader, { className: "bg-gradient-to-r from-[#009688]/10 to-[#1565c0]/10 border-b", children: _jsxs(CardTitle, { className: "flex items-center gap-3", children: [_jsx("div", { className: "p-2 bg-gradient-to-r from-[#009688] to-[#1565c0] rounded-lg", children: _jsx(Brain, { className: "w-5 h-5 text-white" }) }), _jsx("span", { className: "text-lg font-bold", children: "AI Insights" })] }) }), _jsx(CardContent, { className: "p-6", children: _jsxs("div", { className: "text-center py-12", children: [_jsx("div", { className: "p-4 bg-gradient-to-r from-[#009688]/10 to-[#1565c0]/10 rounded-full w-fit mx-auto mb-4", children: _jsx(Brain, { className: "w-8 h-8 text-[#009688]" }) }), _jsx("h3", { className: "text-lg font-semibold text-gray-800 mb-2", children: "AI Insights Coming Soon" }), _jsx("p", { className: "text-sm text-muted-foreground", children: "Advanced AI insights and analytics will be available here" })] }) })] }) }), _jsx(TabsContent, { value: "stats", className: "space-y-6", children: _jsxs(Card, { className: "border-0 shadow-xl bg-white/80 backdrop-blur-sm", children: [_jsx(CardHeader, { className: "bg-gradient-to-r from-[#009688]/10 to-[#1565c0]/10 border-b", children: _jsxs(CardTitle, { className: "flex items-center gap-3", children: [_jsx("div", { className: "p-2 bg-gradient-to-r from-[#009688] to-[#1565c0] rounded-lg", children: _jsx(BarChart3, { className: "w-5 h-5 text-white" }) }), _jsx("span", { className: "text-lg font-bold", children: "Statistics" })] }) }), _jsx(CardContent, { className: "p-6", children: _jsxs("div", { className: "text-center py-12", children: [_jsx("div", { className: "p-4 bg-gradient-to-r from-[#009688]/10 to-[#1565c0]/10 rounded-full w-fit mx-auto mb-4", children: _jsx(BarChart3, { className: "w-8 h-8 text-[#009688]" }) }), _jsx("h3", { className: "text-lg font-semibold text-gray-800 mb-2", children: "Statistics Coming Soon" }), _jsx("p", { className: "text-sm text-muted-foreground", children: "Detailed statistics and analytics will be available here" })] }) })] }) }), _jsx(TabsContent, { value: "categorization", className: "space-y-6", children: _jsx(AITransactionCategorization, {}) }), _jsx(TabsContent, { value: "reports", className: "space-y-6", children: _jsx(AINaturalLanguageReports, {}) }), _jsx(TabsContent, { value: "parser", className: "space-y-6", children: _jsx(ConversationalParser, { companyId: companyId }) })] }) })] }));
}
